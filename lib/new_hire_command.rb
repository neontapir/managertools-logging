# frozen_string_literal: true

require 'fileutils'
require 'ostruct'
require_relative 'employee'
require_relative 'employee_file'
require_relative 'file_writer'
require_relative 'observation_entry'

# Create a new entry for a person
class NewHireCommand
  include FileWriter

  # @!method command(arguments, options)
  #   Create new overview and load files for a person
  def command(arguments, options = nil)
    force = (options&.force == true)

    team, first, last = arguments
    raise 'missing team argument' unless team
    raise 'missing first name argument' unless first
    raise 'missing last name argument' unless last

    employee = Employee.new(team: team, first: first, last: last)
    folder = EmployeeFolder.new employee
    folder.ensure_exists

    nhc_parameters = OpenStruct.new(folder: folder, force: force)
    generate_overview_file_by(nhc_parameters)
    generate_log_file_by(nhc_parameters)
  end

  private

  def generate_file_by(nhc_parameters, filename)
    content_file = EmployeeFile.new nhc_parameters.folder, filename
    print "\nReviewing #{content_file}... "
    if !nhc_parameters.force && File.exist?(content_file.path)
      print 'exists'
    else
      yield(content_file)
    end
    print "\n"
  end

  def generate_overview_file_by(nhc_parameters)
    generate_file_by(nhc_parameters, 'overview.adoc') do |content_file|
      create_overview_file nhc_parameters.folder, content_file
    end
  end

  def generate_log_file_by(nhc_parameters)
    generate_file_by(nhc_parameters, 'log.adoc') do |content_file|
      create_log_file content_file
    end
  end

  def create_overview_file(folder, overview_file)
    employee = folder.employee
    contents = <<~OVERVIEW
      :imagesdir: #{folder.path}

      == #{employee}

      image::headshot.jpg[#{employee}, width="200", align="right", float="right"]

      Team: #{employee.team.capitalize}

    OVERVIEW
    write_file(overview_file.path, contents)
    print 'created'
  end

  def create_log_file(log_file)
    log_file.ensure_exists
    contents = <<~CONTENTS
      === Biographical information

      === Employment information

      Hire Date:
      Grade level:
      ID:

    CONTENTS
    new_file_entry = ObservationEntry.new(content: 'File generated by new-hire command').render('File created')
    contents += new_file_entry
    write_file(log_file.path, contents)
    print 'created'
  end
end
