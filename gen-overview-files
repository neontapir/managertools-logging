#!/usr/bin/env ruby

require 'pathname'
require 'trollop'
require 'facets/string/titlecase'
require_relative 'lib/employee_folder'

class String
  def titleize
    split(/(\W)/).map(&:capitalize).join
  end
end

def split_path(path)
    Pathname(path).each_filename.to_a
end

if __FILE__==$0
  opts = Trollop::options do
    opt :force, 'generate even if file exists', :default => false
  end

  Dir.glob("#{EmployeeFolder.root}/*/*") do |f|
     next unless Dir.exist? f
     paths = split_path f
     name = paths[2].gsub!('-', ' ').titleize
     puts "Generating #{paths[1]} #{name}..."
     force = if opts[:force] then "--force" else "" end
     system('./new-hire', force, "--team", "#{paths[1]}", "--name", "#{name}") or exit(-1)
  end
end
